# CatchCore èŠ‚ç‚¹éƒ¨ç½²æŒ‡å—

## ğŸ“š ç›®å½•
1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [èŠ‚ç‚¹ç³»ç»Ÿè¦æ±‚](#èŠ‚ç‚¹ç³»ç»Ÿè¦æ±‚)
3. [èŠ‚ç‚¹ç±»å‹è¯´æ˜](#èŠ‚ç‚¹ç±»å‹è¯´æ˜)
4. [æ ¸å¿ƒèŠ‚ç‚¹éƒ¨ç½²](#æ ¸å¿ƒèŠ‚ç‚¹éƒ¨ç½²)
5. [æ‰«æèŠ‚ç‚¹éƒ¨ç½²](#æ‰«æèŠ‚ç‚¹éƒ¨ç½²)
6. [èŠ‚ç‚¹æ³¨å†Œå’Œç®¡ç†](#èŠ‚ç‚¹æ³¨å†Œå’Œç®¡ç†)
7. [èŠ‚ç‚¹å¥åº·æ£€æŸ¥](#èŠ‚ç‚¹å¥åº·æ£€æŸ¥)
8. [ä»»åŠ¡åˆ†é…](#ä»»åŠ¡åˆ†é…)
9. [ç›‘æ§å’Œç»´æŠ¤](#ç›‘æ§å’Œç»´æŠ¤)
10. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## æ¶æ„æ¦‚è¿°

CatchCore é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œæ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²ã€‚æ•´ä¸ªç³»ç»Ÿç”±ä»¥ä¸‹ç»„ä»¶ç»„æˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Master æœåŠ¡å™¨ (æ ¸å¿ƒèŠ‚ç‚¹)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  FastAPI     â”‚  PostgreSQL  â”‚    Redis     â”‚    â”‚
â”‚  â”‚  åç«¯æœåŠ¡    â”‚   æ•°æ®åº“     â”‚   ç¼“å­˜é˜Ÿåˆ—    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ä»»åŠ¡è°ƒåº¦å™¨ & èŠ‚ç‚¹ç®¡ç†å™¨          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚           â”‚           â”‚
           â–¼           â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æ‰«æèŠ‚ç‚¹   â”‚ â”‚  æ‰«æèŠ‚ç‚¹   â”‚ â”‚  æ‰«æèŠ‚ç‚¹   â”‚
    â”‚   Node 1   â”‚ â”‚   Node 2   â”‚ â”‚   Node 3   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶
- **Master æœåŠ¡å™¨**: ä¸­å¤®æ§åˆ¶å™¨ï¼Œç®¡ç†æ‰€æœ‰èŠ‚ç‚¹å’Œä»»åŠ¡
- **æ‰«æèŠ‚ç‚¹**: æ‰§è¡Œå®é™…æ‰«æä»»åŠ¡çš„å·¥ä½œèŠ‚ç‚¹
- **æ•°æ®åº“**: PostgreSQL å­˜å‚¨æ‰€æœ‰æ•°æ®
- **ç¼“å­˜/é˜Ÿåˆ—**: Redis è¿›è¡Œä»»åŠ¡é˜Ÿåˆ—å’Œå®æ—¶é€šä¿¡
- **ä»»åŠ¡è°ƒåº¦**: è´Ÿè´£å°†ä»»åŠ¡åˆ†é…ç»™åˆé€‚çš„èŠ‚ç‚¹

---

## èŠ‚ç‚¹ç³»ç»Ÿè¦æ±‚

### Master èŠ‚ç‚¹ï¼ˆæ ¸å¿ƒæœåŠ¡å™¨ï¼‰
```
æ“ä½œç³»ç»Ÿ:     Linux (Ubuntu 20.04+) / macOS / Windows (WSL2)
Python:       3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
CPU:          4 æ ¸æˆ–ä»¥ä¸Š
å†…å­˜:         8GB æˆ–ä»¥ä¸Šï¼ˆç”Ÿäº§ç¯å¢ƒ 16GB+ï¼‰
ç£ç›˜:         50GB å¯ç”¨ç©ºé—´
ç½‘ç»œ:         ç¨³å®šçš„äº’è”ç½‘è¿æ¥
æ•°æ®åº“:       PostgreSQL 13+
ç¼“å­˜:         Redis 6.0+
```

### æ‰«æèŠ‚ç‚¹
```
æ“ä½œç³»ç»Ÿ:     Linux / macOS / Windows (WSL2)
Python:       3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
CPU:          2 æ ¸æˆ–ä»¥ä¸Š
å†…å­˜:         4GB æˆ–ä»¥ä¸Š
ç£ç›˜:         20GB å¯ç”¨ç©ºé—´
ç½‘ç»œ:         ä¸ Master èŠ‚ç‚¹çš„ç¨³å®šè¿æ¥
æ‰«æå·¥å…·:     FScan, Nuclei, Afrog, DDDD, DirSearchï¼ˆè‡ªåŠ¨å®‰è£…ï¼‰
```

### ç½‘ç»œè¦æ±‚
```
Master èŠ‚ç‚¹æš´éœ²ç«¯å£:
  - 8000 (FastAPI åº”ç”¨)
  - 5432 (PostgreSQL)
  - 6379 (Redis)
  - 8086 (InfluxDB)

æ‰«æèŠ‚ç‚¹éœ€è¦è®¿é—®:
  - Master:8000 (API é€šä¿¡)
  - Master:6379 (Redis é˜Ÿåˆ—)
  - äº’è”ç½‘ (ä¸‹è½½å·¥å…·å’Œç›®æ ‡æ‰«æ)
```

---

## èŠ‚ç‚¹ç±»å‹è¯´æ˜

CatchCore æ”¯æŒå¤šç§èŠ‚ç‚¹ç±»å‹ï¼š

### 1. Scanner èŠ‚ç‚¹ï¼ˆé»˜è®¤ï¼‰
- **åŠŸèƒ½**: æ‰§è¡Œæ‰«æä»»åŠ¡ï¼ˆç«¯å£æ‰«æã€æœåŠ¡è¯†åˆ«ã€æŒ‡çº¹è¯†åˆ«ç­‰ï¼‰
- **èµ„æºæ¶ˆè€—**: ä¸­ç­‰
- **å¹¶å‘ä»»åŠ¡**: 5-10 ä¸ª
- **ç”¨é€”**: åˆ†å¸ƒå¼æ‰«ææ‰§è¡Œ

### 2. Worker èŠ‚ç‚¹
- **åŠŸèƒ½**: æ‰§è¡Œé€šç”¨è®¡ç®—ä»»åŠ¡ï¼ˆPOC æ£€æµ‹ã€å¯†ç ç ´è§£ç­‰ï¼‰
- **èµ„æºæ¶ˆè€—**: é«˜
- **å¹¶å‘ä»»åŠ¡**: 2-5 ä¸ª
- **ç”¨é€”**: è®¡ç®—å¯†é›†å‹ä»»åŠ¡

### 3. Coordinator èŠ‚ç‚¹
- **åŠŸèƒ½**: è¾…åŠ©åè°ƒä»»åŠ¡åˆ†é…ï¼ˆæœªæ¥æ‰©å±•ï¼‰
- **èµ„æºæ¶ˆè€—**: ä½
- **å¹¶å‘ä»»åŠ¡**: æ— é™åˆ¶
- **ç”¨é€”**: åˆ†å¸ƒå¼åè°ƒ

---

## æ ¸å¿ƒèŠ‚ç‚¹éƒ¨ç½²

### æ­¥éª¤ 1: å‡†å¤‡ Master æœåŠ¡å™¨

#### 1.1 ç³»ç»Ÿæ›´æ–°ï¼ˆUbuntu/Debianï¼‰
```bash
sudo apt update
sudo apt upgrade -y
sudo apt install -y python3 python3-pip python3-venv git curl wget \
  postgresql postgresql-contrib redis-server docker.io docker-compose
```

#### 1.2 å¯åŠ¨åŸºç¡€æœåŠ¡
```bash
# å¯åŠ¨ PostgreSQL
sudo systemctl start postgresql
sudo systemctl enable postgresql

# å¯åŠ¨ Redis
sudo systemctl start redis-server
sudo systemctl enable redis-server

# æˆ–ä½¿ç”¨ Docker Compose
cd /path/to/CatchCore
docker-compose up -d postgres redis influxdb
```

### æ­¥éª¤ 2: å…‹éš†é¡¹ç›®å¹¶é…ç½®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/TaoKe-One/CatchCore.git
cd CatchCore

# åˆ›å»ºç¯å¢ƒæ–‡ä»¶
cp backend/.env.example backend/.env

# ç¼–è¾‘ç¯å¢ƒæ–‡ä»¶
nano backend/.env
```

### æ­¥éª¤ 3: é…ç½® Master .env æ–‡ä»¶
```env
# åº”ç”¨é…ç½®
APP_NAME=CatchCore
APP_VERSION=0.1.0
DEBUG=False
LOG_LEVEL=INFO

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://catchcore:catchcore@localhost:5432/catchcore_db

# Redis é…ç½®
REDIS_URL=redis://localhost:6379/0

# JWT å®‰å…¨å¯†é’¥ï¼ˆç”Ÿæˆæ–°çš„ï¼ï¼‰
SECRET_KEY=your-very-secret-key-change-this-in-production-use-something-long-and-random
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS é…ç½®
CORS_ORIGINS=["http://localhost:3000", "http://localhost:5173"]

# API é…ç½®
API_V1_PREFIX=/api/v1

# èŠ‚ç‚¹é…ç½®
NODE_HEARTBEAT_INTERVAL=30
NODE_HEARTBEAT_TIMEOUT=120
MAX_NODE_OFFLINE_TIME=300

# InfluxDB é…ç½®ï¼ˆå¯é€‰ï¼‰
INFLUXDB_URL=http://localhost:8086
INFLUXDB_ORG=catchcore
INFLUXDB_BUCKET=scandata
INFLUXDB_TOKEN=your-token-here
```

### æ­¥éª¤ 4: åˆå§‹åŒ–æ•°æ®åº“

```bash
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆå§‹åŒ–æ•°æ®åº“
python3 -m alembic upgrade head

# åˆ›å»ºåˆå§‹ç”¨æˆ·
python3 -c "from app.models.user import User; print('Database initialized')"
```

### æ­¥éª¤ 5: å¯åŠ¨ Master æœåŠ¡å™¨

```bash
# æ–¹å¼ 1: ç›´æ¥è¿è¡Œï¼ˆå¼€å‘ï¼‰
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000

# æ–¹å¼ 2: ä½¿ç”¨ Gunicornï¼ˆç”Ÿäº§ï¼‰
gunicorn -w 4 -b 0.0.0.0:8000 app.main:app

# æ–¹å¼ 3: ä½¿ç”¨ Docker
docker-compose up -d backend
```

### æ­¥éª¤ 6: éªŒè¯ Master éƒ¨ç½²

```bash
# æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# é¢„æœŸå“åº”
# {"status":"ok","version":"0.1.0"}

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
curl http://localhost:8000/api/v1/assets

# å¦‚æœè¿”å› 401ï¼Œè¯´æ˜éœ€è¦è®¤è¯ï¼ˆæ­£å¸¸ï¼‰
```

---

## æ‰«æèŠ‚ç‚¹éƒ¨ç½²

### æ­¥éª¤ 1: å‡†å¤‡æ‰«æèŠ‚ç‚¹

#### 1.1 ç³»ç»Ÿä¾èµ–
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y python3 python3-pip python3-venv git curl wget

# macOS
brew install python3 git

# å®‰è£…æ‰«æå·¥å…·ï¼ˆå¯é€‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½ï¼‰
sudo apt install -y nmap hydra hashcat
```

#### 1.2 å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/TaoKe-One/CatchCore.git
cd CatchCore
```

### æ­¥éª¤ 2: åˆ›å»ºèŠ‚ç‚¹é…ç½®

åœ¨æ¯ä¸ªæ‰«æèŠ‚ç‚¹åˆ›å»º `node_config.yml`ï¼š

```yaml
# node_config.yml
node:
  name: "scanner-node-01"          # å”¯ä¸€èŠ‚ç‚¹åç§°
  type: "scanner"                   # èŠ‚ç‚¹ç±»å‹: scanner, worker
  host: "192.168.1.100"            # æœ¬åœ° IP åœ°å€
  port: 8001                        # æœ¬åœ°ç«¯å£

master:
  host: "192.168.1.50"             # Master æœåŠ¡å™¨ IP
  port: 8000                        # Master API ç«¯å£
  api_url: "http://192.168.1.50:8000/api/v1"

redis:
  host: "192.168.1.50"             # Redis æœåŠ¡å™¨åœ°å€
  port: 6379
  db: 0
  password: null                    # å¦‚æœ Redis è®¾ç½®äº†å¯†ç 

performance:
  max_concurrent_tasks: 5          # æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°
  worker_threads: 4                # å·¥ä½œçº¿ç¨‹æ•°
  heartbeat_interval: 30           # å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰
  check_task_interval: 5           # æ£€æŸ¥ä»»åŠ¡é—´éš”ï¼ˆç§’ï¼‰

tools:
  fscan_enabled: true
  nuclei_enabled: true
  afrog_enabled: true
  dddd_enabled: true
  dirsearch_enabled: true
  auto_install: true               # è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„å·¥å…·
```

### æ­¥éª¤ 3: éƒ¨ç½²èŠ‚ç‚¹æœåŠ¡

#### æ–¹å¼ 1: ç›´æ¥è¿è¡Œï¼ˆå¼€å‘ï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd CatchCore/backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡ŒèŠ‚ç‚¹ä»£ç†ï¼ˆéœ€è¦åˆ›å»º node_agent.pyï¼‰
python3 node_agent.py --config ../node_config.yml
```

#### æ–¹å¼ 2: ä½¿ç”¨ Systemd æœåŠ¡ï¼ˆæ¨èï¼‰

åˆ›å»º `/etc/systemd/system/catchcore-node.service`ï¼š

```ini
[Unit]
Description=CatchCore Scanning Node
After=network.target

[Service]
Type=simple
User=catchcore
WorkingDirectory=/opt/catchcore
Environment="PATH=/opt/catchcore/backend/venv/bin"
ExecStart=/opt/catchcore/backend/venv/bin/python3 node_agent.py --config /opt/catchcore/node_config.yml
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable catchcore-node
sudo systemctl start catchcore-node

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u catchcore-node -f
```

#### æ–¹å¼ 3: ä½¿ç”¨ Docker

åˆ›å»º `Dockerfile.node`ï¼š

```dockerfile
FROM python:3.10-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    git \
    curl \
    wget \
    nmap \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶é¡¹ç›®
COPY backend/ /app/

# å®‰è£… Python ä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶èŠ‚ç‚¹é…ç½®
COPY node_config.yml /app/node_config.yml

# è¿è¡ŒèŠ‚ç‚¹ä»£ç†
CMD ["python3", "node_agent.py", "--config", "/app/node_config.yml"]
```

è¿è¡Œå®¹å™¨ï¼š
```bash
docker build -f Dockerfile.node -t catchcore-node:latest .

docker run -d \
  --name catchcore-node-01 \
  --network host \
  -v /opt/catchcore/node_config.yml:/app/node_config.yml \
  -e MASTER_URL=http://192.168.1.50:8000/api/v1 \
  -e NODE_NAME=scanner-node-01 \
  catchcore-node:latest
```

#### æ–¹å¼ 4: ä½¿ç”¨ Docker Compose

åœ¨ `docker-compose.yml` ä¸­æ·»åŠ èŠ‚ç‚¹æœåŠ¡ï¼š

```yaml
  # æ‰«æèŠ‚ç‚¹ 1
  scanner-node-1:
    build:
      context: ./backend
      dockerfile: Dockerfile.node
    container_name: catchcore-scanner-1
    environment:
      - MASTER_HOST=backend
      - MASTER_PORT=8000
      - NODE_NAME=scanner-node-01
      - NODE_TYPE=scanner
      - MAX_CONCURRENT_TASKS=5
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - backend
      - redis
    volumes:
      - ./data/node-1:/app/data
    networks:
      - catchcore-network

  # æ‰«æèŠ‚ç‚¹ 2
  scanner-node-2:
    build:
      context: ./backend
      dockerfile: Dockerfile.node
    container_name: catchcore-scanner-2
    environment:
      - MASTER_HOST=backend
      - MASTER_PORT=8000
      - NODE_NAME=scanner-node-02
      - NODE_TYPE=scanner
      - MAX_CONCURRENT_TASKS=5
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - backend
      - redis
    volumes:
      - ./data/node-2:/app/data
    networks:
      - catchcore-network
```

å¯åŠ¨èŠ‚ç‚¹ï¼š
```bash
docker-compose up -d scanner-node-1 scanner-node-2
```

---

## èŠ‚ç‚¹æ³¨å†Œå’Œç®¡ç†

### è‡ªåŠ¨èŠ‚ç‚¹æ³¨å†Œ

èŠ‚ç‚¹å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å‘ Master æ³¨å†Œï¼š

```
èŠ‚ç‚¹å¯åŠ¨æµç¨‹ï¼š
1. è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶
2. è¿æ¥åˆ° Master çš„ Redis
3. å‘ Master API å‘é€æ³¨å†Œè¯·æ±‚
4. è·å–èŠ‚ç‚¹ ID å’Œè®¤è¯ä»¤ç‰Œ
5. å¯åŠ¨å¿ƒè·³çº¿ç¨‹
6. å¼€å§‹ç›‘å¬ä»»åŠ¡é˜Ÿåˆ—
```

### æ‰‹åŠ¨èŠ‚ç‚¹æ³¨å†Œ API

å¦‚æœéœ€è¦æ‰‹åŠ¨æ³¨å†ŒèŠ‚ç‚¹ï¼š

```bash
curl -X POST http://localhost:8000/api/v1/nodes/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "scanner-node-01",
    "host": "192.168.1.100",
    "port": 8001,
    "node_type": "scanner",
    "max_concurrent_tasks": 5,
    "api_version": "0.1.0"
  }'
```

å“åº”ï¼š
```json
{
  "id": 1,
  "name": "scanner-node-01",
  "host": "192.168.1.100",
  "port": 8001,
  "status": "online",
  "node_type": "scanner",
  "created_at": "2025-11-14T10:30:00Z"
}
```

### æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹

```bash
curl -X GET http://localhost:8000/api/v1/nodes \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### æ›´æ–°èŠ‚ç‚¹é…ç½®

```bash
curl -X PUT http://localhost:8000/api/v1/nodes/1 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "max_concurrent_tasks": 8,
    "status": "maintenance"
  }'
```

### åˆ é™¤èŠ‚ç‚¹

```bash
curl -X DELETE http://localhost:8000/api/v1/nodes/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## èŠ‚ç‚¹å¥åº·æ£€æŸ¥

### å¿ƒè·³æœºåˆ¶

æ¯ä¸ªæ‰«æèŠ‚ç‚¹å®šæœŸå‘ Master å‘é€å¿ƒè·³ï¼š

```
å¿ƒè·³åŒ…å†…å®¹ï¼š
{
  "node_id": 1,
  "timestamp": "2025-11-14T10:30:00Z",
  "status": "online",
  "cpu_usage": 45.5,
  "memory_usage": 62.3,
  "disk_usage": 38.9,
  "current_tasks": 3,
  "api_version": "0.1.0"
}
```

### å¥åº·æ£€æŸ¥ API

```bash
# æ£€æŸ¥å•ä¸ªèŠ‚ç‚¹çŠ¶æ€
curl -X GET http://localhost:8000/api/v1/nodes/1/health \
  -H "Authorization: Bearer YOUR_TOKEN"

# å“åº”
{
  "id": 1,
  "name": "scanner-node-01",
  "status": "online",
  "last_heartbeat": "2025-11-14T10:30:00Z",
  "cpu_usage": 45.5,
  "memory_usage": 62.3,
  "disk_usage": 38.9,
  "current_tasks": 3,
  "is_healthy": true
}
```

### ç¦»çº¿æ£€æµ‹

- èŠ‚ç‚¹ç¦»çº¿è¶…æ—¶: 120 ç§’
- è‡ªåŠ¨å°†ç¦»çº¿èŠ‚ç‚¹æ ‡è®°ä¸º "offline"
- ç¦»çº¿èŠ‚ç‚¹ä¸Šçš„ä»»åŠ¡ä¼šé‡æ–°åˆ†é…

---

## ä»»åŠ¡åˆ†é…

### ä»»åŠ¡åˆ†é…æµç¨‹

```
ä»»åŠ¡åˆ›å»º â†’ å…¥é˜Ÿ â†’ è°ƒåº¦å™¨æ£€æŸ¥ â†’ é€‰æ‹©åˆé€‚èŠ‚ç‚¹ â†’ å‘é€åˆ°èŠ‚ç‚¹ â†’ æ‰§è¡Œ â†’ å›æŠ¥ç»“æœ
```

### èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥

è°ƒåº¦å™¨ä½¿ç”¨ä»¥ä¸‹ç­–ç•¥é€‰æ‹©æœ€ä¼˜èŠ‚ç‚¹ï¼š

1. **å¥åº·æ€§æ£€æŸ¥**: åªé€‰æ‹©åœ¨çº¿ä¸”å¥åº·çš„èŠ‚ç‚¹
2. **å®¹é‡æ£€æŸ¥**: èŠ‚ç‚¹å½“å‰ä»»åŠ¡æ•° < æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°
3. **è´Ÿè½½å‡è¡¡**: ä¼˜å…ˆé€‰æ‹©ä»»åŠ¡æ•°æœ€å°‘çš„èŠ‚ç‚¹
4. **äº²å’Œæ€§**: ä¼˜å…ˆé€‰æ‹©åŒä¸€åœ°åŸŸ/ç½‘ç»œçš„èŠ‚ç‚¹ï¼ˆå¦‚æœé…ç½®ï¼‰
5. **ä¼˜å…ˆçº§**: æ ¹æ®ä»»åŠ¡ä¼˜å…ˆçº§é€‰æ‹©é€‚åˆçš„èŠ‚ç‚¹ç±»å‹

### ç¤ºä¾‹: åˆ›å»ºæ‰«æä»»åŠ¡

```bash
curl -X POST http://localhost:8000/api/v1/tasks \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "name": "Port Scan - 192.168.1.0/24",
    "task_type": "port_scan",
    "target_range": "192.168.1.0/24",
    "priority": 8,
    "description": "Scan local network for open ports"
  }'
```

ä»»åŠ¡ä¼šè‡ªåŠ¨åˆ†é…ç»™å¯ç”¨çš„ Scanner èŠ‚ç‚¹ã€‚

---

## ç›‘æ§å’Œç»´æŠ¤

### ç›‘æ§ä»ªè¡¨æ¿

ä½¿ç”¨ Web UI æŸ¥çœ‹ï¼š
- æ‰€æœ‰èŠ‚ç‚¹çš„å®æ—¶çŠ¶æ€
- æ¯ä¸ªèŠ‚ç‚¹çš„èµ„æºä½¿ç”¨æƒ…å†µ
- è¿è¡Œä¸­çš„ä»»åŠ¡åˆ†å¸ƒ
- å†å²ç»Ÿè®¡ä¿¡æ¯

è®¿é—®: `http://localhost:3000/nodes`

### æ€§èƒ½æŒ‡æ ‡

é€šè¿‡ InfluxDB + Grafana ç›‘æ§ï¼š

```bash
# èŠ‚ç‚¹ CPU ä½¿ç”¨ç‡
SELECT mean("cpu_usage") FROM "node_metrics"
WHERE time > now() - 1h
GROUP BY time(5m), "node_name"

# èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡
SELECT mean("memory_usage") FROM "node_metrics"
WHERE time > now() - 1h
GROUP BY time(5m), "node_name"

# ä»»åŠ¡å®Œæˆç‡
SELECT mean("completed_tasks") FROM "node_metrics"
WHERE time > now() - 1d
GROUP BY time(1h), "node_name"
```

### æ—¥å¿—æ”¶é›†

èŠ‚ç‚¹æ—¥å¿—ä½ç½®ï¼š
- **ç›´æ¥è¿è¡Œ**: `./logs/node_agent.log`
- **Systemd**: `journalctl -u catchcore-node`
- **Docker**: `docker logs catchcore-node-01`

### å®šæœŸç»´æŠ¤ä»»åŠ¡

```bash
# æ¯å‘¨æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
curl -X GET http://localhost:8000/api/v1/nodes \
  -H "Authorization: Bearer YOUR_TOKEN" | jq '.[] | select(.status != "online")'

# æ¸…ç†æ—§æ—¥å¿—ï¼ˆ30 å¤©ä»¥å‰ï¼‰
find ./logs -name "*.log" -mtime +30 -delete

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥æ•°æ®åº“å¤§å°
psql -U catchcore -d catchcore_db -c "SELECT pg_database.datname, pg_size_pretty(pg_database_size(pg_database.datname)) AS size FROM pg_database;"
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: èŠ‚ç‚¹æ— æ³•è¿æ¥åˆ° Master

**ç—‡çŠ¶**: èŠ‚ç‚¹å¯åŠ¨åæ˜¾ç¤º"æ— æ³•è¿æ¥åˆ° Master"

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping master_ip

# 2. æ£€æŸ¥ Master ç«¯å£æ˜¯å¦å¼€æ”¾
telnet master_ip 8000

# 3. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status
sudo ufw allow 8000/tcp

# 4. æ£€æŸ¥ Master æ˜¯å¦è¿è¡Œ
curl http://master_ip:8000/health

# 5. æŸ¥çœ‹èŠ‚ç‚¹æ—¥å¿—
tail -f logs/node_agent.log
```

### é—®é¢˜ 2: èŠ‚ç‚¹ä»»åŠ¡åˆ†é…å¤±è´¥

**ç—‡çŠ¶**: ä»»åŠ¡ä¸€ç›´å¤„äº PENDING çŠ¶æ€

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿
curl -X GET http://localhost:8000/api/v1/nodes \
  -H "Authorization: Bearer YOUR_TOKEN"

# 2. æ£€æŸ¥èŠ‚ç‚¹å®¹é‡
# ç¡®ä¿ current_tasks < max_concurrent_tasks

# 3. æ£€æŸ¥ä»»åŠ¡é…ç½®
curl -X GET http://localhost:8000/api/v1/tasks/1 \
  -H "Authorization: Bearer YOUR_TOKEN"

# 4. é‡å¯èŠ‚ç‚¹
systemctl restart catchcore-node
```

### é—®é¢˜ 3: èŠ‚ç‚¹å†…å­˜æŒç»­å¢é•¿

**ç—‡çŠ¶**: èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡é€æ­¥ä¸Šå‡

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. å¢åŠ  Python åƒåœ¾å›æ”¶é¢‘ç‡
export PYTHONGC_THRESHOLD=700,5,5

# 2. é™åˆ¶å†…å­˜ä½¿ç”¨ï¼ˆé€šè¿‡ cgroupï¼‰
sudo cgcreate -g memory:/catchcore-node
sudo cgset -r memory.limit_in_bytes=4G /catchcore-node

# 3. å®šæœŸé‡å¯èŠ‚ç‚¹
# åœ¨ systemd ä¸­æ·»åŠ :
ExecStartPost=/bin/bash -c 'systemctl restart --time=86400 %n'

# 4. æŸ¥çœ‹å†…å­˜ä½¿ç”¨è¯¦æƒ…
ps aux | grep node_agent
ps -eo pid,user,vsize,rss | grep python
```

### é—®é¢˜ 4: ä»»åŠ¡æ‰§è¡Œè¶…æ—¶

**ç—‡çŠ¶**: ä»»åŠ¡ç»å¸¸è¶…æ—¶ä¸”æ— æ³•å®Œæˆ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. å¢åŠ ä»»åŠ¡è¶…æ—¶æ—¶é—´
# åœ¨ .env ä¸­æ·»åŠ :
TASK_TIMEOUT_SECONDS=3600

# 2. æé«˜èŠ‚ç‚¹èµ„æºåˆ†é…
# å¢åŠ  max_concurrent_tasks çš„å€¼ï¼ˆ2-3ï¼‰

# 3. æ£€æŸ¥ç›®æ ‡ç½‘ç»œè¿æ¥
ping target_ip
traceroute target_ip

# 4. æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—
curl -X GET http://localhost:8000/api/v1/tasks/1/logs \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### é—®é¢˜ 5: Redis è¿æ¥é”™è¯¯

**ç—‡çŠ¶**: "redis.exceptions.ConnectionError"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ Redis çŠ¶æ€
redis-cli ping

# 2. æ£€æŸ¥ Redis é…ç½®
redis-cli CONFIG GET maxmemory
redis-cli CONFIG GET maxmemory-policy

# 3. å¢åŠ  Redis å†…å­˜é™åˆ¶
redis-cli CONFIG SET maxmemory 2gb
redis-cli CONFIG SET maxmemory-policy allkeys-lru

# 4. é‡å¯ Redis
sudo systemctl restart redis-server

# 5. æ£€æŸ¥è¿æ¥å­—ç¬¦ä¸²
# ç¡®ä¿ REDIS_URL æ ¼å¼æ­£ç¡®: redis://[password@]host:port/db
```

### é—®é¢˜ 6: æ•°æ®åº“è¿æ¥æ± è€—å°½

**ç—‡çŠ¶**: "psycopg2.pool.PoolError: connection pool is exhausted"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. å¢åŠ è¿æ¥æ± å¤§å°ï¼ˆbackend/.envï¼‰
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=40

# 2. æ£€æŸ¥æ´»è·ƒè¿æ¥
psql -U catchcore -d catchcore_db -c "SELECT count(*) FROM pg_stat_activity;"

# 3. æ€æ­»é•¿æ—¶é—´è¿æ¥
psql -U catchcore -d catchcore_db -c "
  SELECT pg_terminate_backend(pid)
  FROM pg_stat_activity
  WHERE now() - query_start > interval '1 hour';"

# 4. é‡å¯åç«¯æœåŠ¡
docker restart catchcore-backend
```

---

## æ‰©å±•å’Œä¼˜åŒ–

### æ°´å¹³æ‰©å±•

æ·»åŠ æ›´å¤šæ‰«æèŠ‚ç‚¹ï¼š

1. ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºå”¯ä¸€çš„ `node_config.yml`
2. ä½¿ç”¨ä¸åŒçš„ `name` å­—æ®µ
3. éƒ¨ç½²èŠ‚ç‚¹ï¼ˆæŒ‰ç…§ä¸Šè¿°æ–¹å¼ï¼‰
4. èŠ‚ç‚¹è‡ªåŠ¨æ³¨å†Œå¹¶åŠ å…¥é›†ç¾¤

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

```yaml
ä¼˜åŒ–é…ç½®:
  worker_threads: 8              # å¢åŠ çº¿ç¨‹æ•°ï¼ˆCPU æ ¸å¿ƒæ•° Ã— 2ï¼‰
  max_concurrent_tasks: 10       # æ ¹æ®èµ„æºè°ƒæ•´
  heartbeat_interval: 60         # å‡å°‘å¿ƒè·³é¢‘ç‡èŠ‚çœç½‘ç»œ
  check_task_interval: 1         # å¢åŠ æ£€æŸ¥é¢‘ç‡ä½†è¦æ³¨æ„ CPU
  connection_pool_size: 50       # å¢åŠ è¿æ¥æ± 
```

### èµ„æºéš”ç¦»

ä½¿ç”¨ cgroup/å®¹å™¨é™åˆ¶èµ„æºï¼š

```bash
# CPU é™åˆ¶ (Docker)
docker run --cpus="2" catchcore-node

# å†…å­˜é™åˆ¶ (Docker)
docker run --memory="4g" catchcore-node

# ç»„åˆ
docker run \
  --cpus="2" \
  --memory="4g" \
  --memory-swap="5g" \
  catchcore-node
```

---

## æœ€ä½³å®è·µ

âœ… **æ¨èåšæ³•**
- ä¸ºæ¯ä¸ªèŠ‚ç‚¹é…ç½®ä¸åŒçš„ hostname
- å®šæœŸå¤‡ä»½ PostgreSQL æ•°æ®åº“
- ä½¿ç”¨ HTTPS åœ¨ç”Ÿäº§ç¯å¢ƒ
- ç›‘æ§èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
- å®šæœŸæ¸…ç†æ—§æ—¥å¿—å’Œæ•°æ®
- åœ¨ä¸åŒç½‘ç»œåŒºåŸŸéƒ¨ç½²èŠ‚ç‚¹
- ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¯é€‰ï¼‰

âŒ **åº”é¿å…**
- åœ¨åŒä¸€æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ª Master å®ä¾‹
- ç›´æ¥æš´éœ² Redis åˆ°äº’è”ç½‘
- ä½¿ç”¨é»˜è®¤æ•°æ®åº“å¯†ç 
- ç¦ç”¨æ—¥å¿—è®°å½•
- è¿‡åº¦è¶…é…èŠ‚ç‚¹ä»»åŠ¡
- å¿½è§†å®‰å…¨æ›´æ–°

---

## å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨

```bash
# èŠ‚ç‚¹ç®¡ç†
curl -X POST http://master:8000/api/v1/nodes/register      # æ³¨å†ŒèŠ‚ç‚¹
curl -X GET http://master:8000/api/v1/nodes                # åˆ—å‡ºèŠ‚ç‚¹
curl -X GET http://master:8000/api/v1/nodes/1/health       # æ£€æŸ¥å¥åº·çŠ¶æ€
curl -X PUT http://master:8000/api/v1/nodes/1              # æ›´æ–°èŠ‚ç‚¹
curl -X DELETE http://master:8000/api/v1/nodes/1           # åˆ é™¤èŠ‚ç‚¹

# ä»»åŠ¡ç®¡ç†
curl -X POST http://master:8000/api/v1/tasks               # åˆ›å»ºä»»åŠ¡
curl -X GET http://master:8000/api/v1/tasks/1              # æŸ¥çœ‹ä»»åŠ¡
curl -X GET http://master:8000/api/v1/tasks/1/progress     # æŸ¥çœ‹è¿›åº¦
curl -X GET http://master:8000/api/v1/tasks/1/logs         # æŸ¥çœ‹æ—¥å¿—

# ç³»ç»Ÿç›‘æ§
curl -X GET http://master:8000/health                      # å¥åº·æ£€æŸ¥
curl -X GET http://master:8000/api/v1/nodes/stats          # èŠ‚ç‚¹ç»Ÿè®¡
curl -X GET http://master:8000/api/v1/tasks/stats          # ä»»åŠ¡ç»Ÿè®¡

# Systemd æœåŠ¡
sudo systemctl start catchcore-node                         # å¯åŠ¨æœåŠ¡
sudo systemctl stop catchcore-node                          # åœæ­¢æœåŠ¡
sudo systemctl restart catchcore-node                       # é‡å¯æœåŠ¡
sudo systemctl status catchcore-node                        # æŸ¥çœ‹çŠ¶æ€
sudo journalctl -u catchcore-node -f                        # å®æ—¶æ—¥å¿—

# Docker æ“ä½œ
docker-compose up -d                                       # å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d scanner-node-1                        # å¯åŠ¨ç‰¹å®šèŠ‚ç‚¹
docker-compose ps                                          # æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker logs catchcore-scanner-1                            # æŸ¥çœ‹æ—¥å¿—
docker inspect catchcore-scanner-1                         # æ£€æŸ¥é…ç½®
```

---

## æ”¯æŒå’Œåé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ­¤æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æŸ¥çœ‹é¡¹ç›® GitHub Issues
3. æäº¤æ–° Issue æˆ– Pull Request

**é¡¹ç›®åœ°å€**: https://github.com/TaoKe-One/CatchCore
**æ–‡æ¡£æ›´æ–°**: 2025-11-14

---

